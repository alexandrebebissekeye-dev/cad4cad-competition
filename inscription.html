<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Inscription CAD4CAD</title>

<link rel="stylesheet" href="style.css">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

</head>

<body>

<header>
    <div class="logo-container">
        <img src="image/emia.jpg">
        <h1>Inscription CAD4CAD</h1>
    </div>
</header>


<section class="register">

<h2>Formulaire d'inscription</h2>

<form id="inscriptionForm" class="formulaire">

<input type="text" id="nom" placeholder="Nom complet" required>
<input type="text" id="niveau" placeholder="Niveau (N1, N2, N3)" required>
<input type="text" id="formation" placeholder="Formation (FI / FA)" required>
<input type="text" id="filiere" placeholder="Filière" required>
<input type="tel" id="telephone" placeholder="Numéro WhatsApp" required>
<input type="text" id="logiciel" placeholder="Logiciel CAO utilisé" required>
<input type="text" id="ecole" placeholder="École" required>
<input type="email" id="email" placeholder="Adresse Email" required>

<button type="submit" class="btn-register">Terminer inscription</button>

</form>

</section>



<script>
  // 1. Vérification que Supabase est bien chargé
  if (typeof supabase === 'undefined') {
      console.error("La librairie Supabase ne s'est pas chargée !");
      alert("Erreur technique : Impossible de charger le système d'inscription.");
  } else {
      console.log("Supabase chargé avec succès.");
  }

  // 2. Configuration
  const supabaseUrl = "https://opnfzyevppoacawbnnco.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9wbmZ6eWV2cHBvYWNhd2JubmNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxNTc0NDcsImV4cCI6MjA4NTczMzQ0N30.NIKt_io-bRgGyYI_zDaQn5P1pDGFxheuVzIHcn7lMaE";
  
  // Utilisation directe de 'supabase' (la variable globale créée par le script CDN)
  const client = supabase.createClient(supabaseUrl, supabaseKey);

  // 3. Soumission du formulaire
  const form = document.getElementById("inscriptionForm");
  
  form.addEventListener("submit", async (e) => {
      e.preventDefault(); // Empêche le rechargement de la page
      console.log("Bouton cliqué, début de l'envoi...");

      const btn = document.querySelector(".btn-register");
      btn.textContent = "Envoi en cours...";
      btn.disabled = true;

      // Récupération des données
      const data = {
          nom_complet: document.getElementById("nom").value,
          niveau: document.getElementById("niveau").value,
          formation: document.getElementById("formation").value,
          filiere: document.getElementById("filiere").value,
          telephone: document.getElementById("telephone").value,
          logiciel: document.getElementById("logiciel").value,
          ecole: document.getElementById("ecole").value,
          email: document.getElementById("email").value
      };

      try {
          // Insertion dans Supabase
          const { error } = await client
              .from("inscriptions")
              .insert([data]);

          if (error) {
              console.error("Erreur Supabase:", error);
              alert("Erreur lors de l'enregistrement : " + error.message);
              // Réactiver le bouton en cas d'erreur
              btn.textContent = "Terminer inscription";
              btn.disabled = false;
          } else {
              console.log("Succès !");
              alert("Inscription réussie ! Redirection...");
              window.location.href = "exam.html";
          }
      } catch (err) {
          console.error("Erreur inattendue:", err);
          alert("Une erreur inattendue s'est produite.");
      }
  });
</script>

</body>
</html>
